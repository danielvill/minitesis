{% extends "admin/layout.html" %}

{% block content %}

<main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-4" id="main-content">
    <div class="cover">
        <h1>Ingresado de Producto</h1>
    </div>
    <br>
    <div class="container">
        <form action="/admin/products" method="POST" id="myForm">
            <select name="nombre">
                {% for nombre in nombres %}
                <option value="{{nombre['nombre']}}">{{nombre['nombre']}}</option>
                {% endfor %}
            </select>
            <input type="date" name="fecha_p" placeholder="Fecha de Peticion">
            <input type="date" name="fecha_co" placeholder="Fecha de Cobranza">

            <br>
            <br>
            <div class="productos">
                <input type="text" name="codigo[]" class=" codigo" placeholder="codigo">
                <input type="text" name="precio[]" class=" precio" placeholder="precio">
                <input type="text" name="cantidad[]" class=" cantidad" placeholder="cantidad">
                <input type="text" name="resultado[]" class=" resultado" placeholder="resultado">
                <a href="javascript:void(0);" class="remove_button">Eliminar</a>
            </div>

            <div class="form-row">
                <div class="col-8"></div>
                <div class="col-5">
                    <br>
                    <br>
                    <input type="text" name="total" id="total" placeholder="Total">
                    <br>
                    <br>
                    <button type="button" id="addButton" class="btn btn-primary ">Agregar Producto</button>
                    <button type="button" class="btn btn-primary" id="openModalBtn">Enviar</button>
                </div>
            </div>
        </form>
    
<!-- Ventana Modal -->
<div class="modal" id="confirmationModal">
    <div class="modal-content">
        <p >¿Está seguro de querer enviar el formulario?</p>
        <button type="button" id="confirmYesBtn">Sí</button>
        <button type="button" id="confirmNoBtn">No</button>
    </div>
</div>


</main>

<script>
    document.addEventListener("DOMContentLoaded", function () {
    var openModalBtn = document.getElementById("openModalBtn");
    var confirmationModal = document.getElementById("confirmationModal");
    var confirmYesBtn = document.getElementById("confirmYesBtn");
    var confirmNoBtn = document.getElementById("confirmNoBtn");

    openModalBtn.addEventListener("click", function () {
        // Verificar si los campos no están en blanco
        if (camposNoEstanEnBlanco()) {
            confirmationModal.style.display = "block";
        } else {
            alert("Por favor, rellena todos los campos antes de enviar.");
        }
    });

    confirmYesBtn.addEventListener("click", function () {
        document.getElementById("myForm").submit();
    });

    confirmNoBtn.addEventListener("click", function () {
        confirmationModal.style.display = "none";
    });

    function camposNoEstanEnBlanco() {
        // Obtener los campos del formulario
        var nombreCampo = document.getElementsByName("nombre")[0].value;
        var fecha_pCampo = document.getElementsByName("fecha_p")[0].value;
        var fecha_coCampo = document.getElementsByName("fecha_co")[0].value;
        var codigoCampos = document.querySelectorAll('.codigo');
        var precioCampos = document.querySelectorAll('.precio');
        var cantidadCampos = document.querySelectorAll('.cantidad');

        // Verificar si algún campo está en blanco
        if (
            nombreCampo.trim() === "" ||
            fecha_pCampo.trim() === "" ||
            fecha_coCampo.trim() === "" ||
            Array.from(codigoCampos).some(campo => campo.value.trim() === "") ||
            Array.from(precioCampos).some(campo => campo.value.trim() === "") ||
            Array.from(cantidadCampos).some(campo => campo.value.trim() === "")
        ) {
            return false; // Al menos un campo está en blanco
        }
        return true; // Todos los campos están llenos
    }
});

</script>
<script src="/static/js/product.js"></script>
{% endblock %}